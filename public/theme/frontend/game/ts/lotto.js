(()=>{"use strict";const t=function(){function t(){}return t.showLoading=function(){BASE_GUI.showLoading()},t.createFlashNotify=function(t,e){void 0===e&&(e=!0),BASE_GUI.createFlashNotify(t,e)},t.hideLoading=function(){BASE_GUI.hideLoading()},t}(),e=function(){function t(){}return t.all=function(t){return document.querySelectorAll(t)},t._=function(t){return document.querySelector(t)},t.flex=function(t){t.style.display="flex"},t.none=function(t){t.style.display="none"},t.on=function(t,e,n){document.addEventListener(t,(function(t){for(var o=t.target;o&&o!=this;o=o.parentNode)if(o.matches(e)){n(t);break}}),!1)},t}(),n=function(){function n(t){void 0===t&&(t="ws://localhost:8888/"),this.socketUrl=t,this.connecter=null,this.wsReady=!1,this.openListeners=[],this.messageListeners=[],this.closeListeners=[],this.errorListeners=[]}return n.prototype.addOpenListener=function(t){t&&this.openListeners.push(t)},n.prototype.addMessageListener=function(t){t&&this.messageListeners.push(t)},n.prototype.addCloseListener=function(t){t&&this.closeListeners.push(t)},n.prototype.addErrorListener=function(t){t&&this.errorListeners.push(t)},n.prototype.sendData=function(e,n){void 0===n&&(n=!0),n&&t.showLoading(),this.wsReady?this.connecter.send(e):t.createFlashNotify("Không thể kết nối tới server",!1)},n.prototype.init=function(){var t=e._("input[name=auth_token]");if(t){var n=t.value,o=this.socketUrl+"?auth_token=".concat(n);this.connecter=new WebSocket(o);var i=this;this.connecter.onopen=function(t){i.wsReady=!0;for(var e=0,n=i.openListeners;e<n.length;e++)(0,n[e])(t)},this.connecter.onmessage=function(t){for(var e=0,n=i.messageListeners;e<n.length;e++){var o=n[e],r={};t.data&&(r=JSON.parse(t.data)),o(t,r)}},this.connecter.onclose=function(t){i.wsReady=!1;for(var e=0,n=i.closeListeners;e<n.length;e++)(0,n[e])(t)},this.connecter.onerror=function(t){i.wsReady=!1;for(var e=0,n=i.errorListeners;e<n.length;e++)(0,n[e])(t)}}},n}(),o=function(){function t(){}return Object.defineProperty(t,"currentGameInfo",{get:function(){return t._currentGameInfo},set:function(e){t._currentGameInfo=e},enumerable:!1,configurable:!0}),t.changeGameTitle=function(){var t='<span class="domain xs">Miền Bắc</span> / ',n=e._(".box_booking .box_mini .types"),o=e._(".item_type_game.nav-item input[name=category]:checked").parentElement;o&&(t+='<span class="lotto xs">'.concat(o.innerText,"</span> / "));var i=e._('.type_js.nav-item input[name="type"]:checked').parentElement;i&&(t+='<span class="type xs">'.concat(i.innerText,"</span>")),n.innerHTML=t},t.updateListLotto=function(){var t=e._(".ls_lotto"),n="",o=e.all(".item_number span.choosen"),i=e.all(".list_choosen .item_number_select span.choosen");o.length>0?o.forEach((function(t,e){n+='<span class="lotto">'.concat(t.innerText,"</span>")})):i.length>0?i.forEach((function(t,e){n+='<span class="lotto">'.concat(t.innerText,"</span>")})):n='<span class="no-result">Chưa chọn số</span>',t.innerHTML=n},t.getCurrentTypeGame=function(){var t=e._('.panel .type_js.nav-item[data-state="true"]');return t?t.id:0},t.getCurrentGameConfig=function(){var t=this.getCurrentTypeGame();return LOTTO_TYPES[t]||{}},t._currentGameInfo={},t}();var i=function(){function t(t){this.lottoSocket=t,this.totalMinBet=0,this.betPerNumber=0,this.betWin=0,this.initEvents(),this.initSubmit(),this.changeHtmlPreview()}return t.prototype.initEvents=function(){var t=this;e._('.box_booking input[name="bet"]').addEventListener("change",(function(e){var n=e.target;t.validateMoney(n),t.changeHtmlPreview()}))},t.prototype.initSubmit=function(){var t=this;e._("#lotto_bet").addEventListener("click",(function(e){e.target,t.validateBetting()&&t.sendPlayRequest()}))},t.prototype.sendPlayRequest=function(){var t=e._("input[name=bet]"),n=parseInt(t.value)||0,i=this.getNumberChoosen(),r=o.getCurrentGameConfig().id;this.lottoSocket.sendPlayRequest(r,n,i)},t.prototype.validateBetting=function(){var t=o.getCurrentGameConfig(),n=e._("input[name=bet]");if(!n||!t)return!1;var i=parseInt(n.value)||0,r=this.getNumberChoosen().length,a=r*t.min_bet,s=t.choose_min,c=t.choose_max;return r<s||r>c?(s==c?alert("Bạn cần chọn ".concat(s," số!")):alert("Bạn cần chọn tối thiểu ".concat(s," số và tối đa ").concat(c," số!")),!1):!(i<a&&(alert("Số tiền tối thiểu là ".concat(a,"k!")),1))},t.prototype.validateMoney=function(t){var e=t.value;(e=Math.abs(e))>999999999999&&(e=999999999999),e<1&&(e=1),t.value=e},t.prototype.changeHtmlPreview=function(){this.changeHtmlMinBet(),this.changeHtmlBetPerNumber(),this.changeHtmlWinBet()},t.prototype.changeHtmlMinBet=function(){var t="-",n=o.getCurrentGameConfig();if(n){var i=parseInt(n.min_bet),r=parseInt(n.choose_min);if(this.hasChoosen()){var a=this.getNumberChoosen().length/r;a=a<1?1:a,this.totalMinBet=i*a}else this.totalMinBet=i;t=String(this.totalMinBet)}e._(".plot_total .min span").innerText=t},t.prototype.changeHtmlBetPerNumber=function(){var t="";if(this.hasChoosen()){var n=this.getTotalMoney();this.betPerNumber=n/this.totalMinBet,this.betPerNumber=Math.round(100*this.betPerNumber)/100,t=String(this.betPerNumber)}else t="-";e._(".plot_total .money span").innerText=t},t.prototype.changeHtmlWinBet=function(){var t="";if(this.hasChoosen()){var n=o.getCurrentGameConfig();if(n){var i=parseInt(n.win);this.betWin=this.betPerNumber*i,this.betWin=Math.round(100*this.betWin)/100,t=String(this.betWin)}}else t="-";e._(".plot_total .money_win span").innerText=t},t.prototype.hasChoosen=function(){return e.all(".ls_lotto span.lotto").length>0},t.prototype.getNumberChoosen=function(){for(var t=e.all(".ls_lotto span.lotto"),n=[],o=0;o<t.length;o++){var i=t[o];n.push(i.innerText)}return n},t.prototype.getTotalMoney=function(){var t=e._('.box_booking input[name="bet"]'),n=1;return t&&(n=parseInt(t.value)),n},t.prototype.updateBoxTitle=function(){o.updateListLotto(),o.changeGameTitle()},t}();const r=i,a=function(t){this.formbet=t};var s,c=(s=function(t,e){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},s(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});const u=function(t){function n(e){var n=t.call(this,e)||this;return n.initEvents(),n}return c(n,t),n.prototype.initEvents=function(){var t=this;e.on("click",".ls_number .item_number span",(function(n){var o=n.target,i=e._('.panel .type_js.nav-item[data-state="true"]'),r=i.dataset.target,a=i.id,s=LOTTO_TYPES[a];o.classList.contains("choosen")?o.classList.remove("choosen"):t.validate(r,s)?o.classList.add("choosen"):alert("Bạn chỉ được đánh ".concat(s.choose_max," số!")),t.updateListLotto()}))},n.prototype.updateListLotto=function(){o.updateListLotto(),this.formbet.changeHtmlPreview()},n.prototype.validate=function(t,n){var o=e._(t).querySelectorAll(":scope .item_number span.choosen");return!(!n||o.length>=n.choose_max)},n.prototype.removeChoosen=function(){e.all(".item_number span.choosen").forEach((function(t,e){t.classList.remove("choosen")}))},n}(a);var l=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const h=function(t){function n(e){var n=t.call(this,e)||this;return n.initEvents(),n}return l(n,t),n.prototype.initEvents=function(){var t=this;e.on("click",".ls_number .group_number button.btn_xs",(function(n){var o=n.target,i=e._('.panel .type_js.nav-item[data-state="true"]'),r=i.dataset.target,a=i.id,s=(LOTTO_TYPES[a],o.parent,e._(r)),c=t.getChooseNumber(s);t.addNumber(s,c),t.updateListLotto()})),e.on("click",".ls_number .item_number_select span",(function(t){var e=t.target,n=e.innerHTML;confirm("Bạn muốn xóa số ".concat(n,"?"))&&e.parentElement.remove()}))},n.prototype.updateListLotto=function(){o.updateListLotto(),this.formbet.changeHtmlPreview()},n.prototype.getChooseNumber=function(t){for(var e=t.querySelectorAll(".ls_number .group_number select"),n="",o=0;o<e.length;o++)n+=e[o].value;return n},n.prototype.addNumber=function(t,e){var n=t.querySelector(".ls_number .ls_number.list_choosen");if(n.querySelector('span[data-number="'.concat(e,'"]')))alert("Bạn đã chọn số ".concat(e," trước đó!"));else{var o='<label class="item_number_select">\n            <span type="checkbox" class="choosen" data-number="'.concat(e,'">').concat(e,"</span>\n        </label>");n.insertAdjacentHTML("beforeend",o)}},n.prototype.removeChoosen=function(){e.all(".list_choosen .item_number_select span.choosen").forEach((function(t,e){t.parentElement.remove()}))},n}(a),p=function(){function t(t){this.gameSocket=t,this.interValGameTime=null,this.timeRemaining=0,this.needRetreiveResult=!1,this.gamePlinkoTimeBox=e._("#game-lotto-time-box")}return t.prototype.initInfo=function(t){var e;if(this.gamePlinkoTimeBox&&t.html){this.needRetreiveResult=!0,this.gamePlinkoTimeBox.innerHTML=t.html,this.timeRemaining=null!==(e=t.time_remaining)&&void 0!==e?e:0,this.interValGameTime&&clearInterval(this.interValGameTime);var n=this;n.runMainLoop(),this.interValGameTime=setInterval((function(){n.runMainLoop()}),1e3)}},t.prototype.runMainLoop=function(){var t=this.timeRemaining/60|0,e=this.timeRemaining%60|0;if(t=t<10?"0"+t:String(t),e=e<10?"0"+e:String(e),this.timeRemaining<=0)this.refreshGame();else{var n=this.gamePlinkoTimeBox.querySelector(".out .number");n&&(n.innerHTML='\n                        <div class="item">'.concat(t.substr(0,1),'</div>\n                        <div class="item">').concat(t.substr(1,1),'</div>\n                        <div class="item c-row c-row-middle">:</div>\n                        <div class="item">').concat(e.substr(0,1),'</div>\n                        <div class="item">').concat(e.substr(1,1),"</div>\n                    "))}this.showTimeChecker(),this.timeRemaining--},t.prototype.refreshGame=function(){this.interValGameTime&&clearInterval(this.interValGameTime),window.location.href=window.location.href},t.prototype.showTimeChecker=function(){var t=e._(".result_plot_threads .mark-box"),n=parseInt(LOTTO_CONFIG.LAST_POINT_TO_BET),o=parseInt(LOTTO_CONFIG.NUMBER_TIME_TO_CHECK);if(this.timeRemaining<=n){e.flex(t);var i=n-this.timeRemaining;i=(i=Math.abs(i-o))<10?"0"+i:""+i;for(var r="",a=0;a<i.length;a++)r+='<span class="item m-r-20">'.concat(i.charAt(a),"</span>");t.innerHTML=r}else e.none(t);if(this.timeRemaining<o){if(!this.needRetreiveResult)return;this.needRetreiveResult=!1,this.gameSocket.retrieveResult()}},t}(),f=function(){function e(t){this.psocket=t}return e.prototype.init=function(){var t=this;this.psocket.init(),this.psocket.addOpenListener((function(e){t.onOpenSocket(e)})),this.psocket.addCloseListener((function(e){t.onCloseSocket(e)})),this.psocket.addErrorListener((function(e){t.onErrorSocket(e)})),this.psocket.addMessageListener((function(e,n){t.onMessageSocket(e,n)}))},e.prototype.onOpenSocket=function(e){t.hideLoading()},e.prototype.onCloseSocket=function(e){t.showLoading(),t.createFlashNotify("Không thể kết nối tới server",!1)},e.prototype.onErrorSocket=function(e){t.showLoading(),t.createFlashNotify("Không thể kết nối tới server",!1)},e.prototype.onMessageSocket=function(e,n){t.hideLoading(),n.success&&n.action?this.processMessageData(n):n.message?t.createFlashNotify(n.message):t.createFlashNotify("Lỗi không xác đinh!")},e.prototype.sendData=function(t,e){void 0===e&&(e=!0),this.psocket.sendData(t,e)},e}();var m=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();const v=function(e){function n(t){return e.call(this,t)||this}return m(n,e),n.prototype.onOpenSocket=function(t){e.prototype.onOpenSocket.call(this,t),this.initGame(),this.onOpenSocketCallback&&this.onOpenSocketCallback(t)},n.prototype.initGame=function(){var t={};t.type=connectionGameType,t.action=LOTTO_STATUS.GAME_ACTION_GET_CURRENT_GAME_INFO,this.sendData(JSON.stringify(t))},n.prototype.retrieveResult=function(){var t={};t.type=connectionGameType,t.currentGame=o.currentGameInfo,t.action=LOTTO_STATUS.GAME_ACTION_RETRIEVE_RESULT,this.sendData(JSON.stringify(t))},n.prototype.sendPlayRequest=function(t,e,n){var i={};i.type=connectionGameType,i.action=LOTTO_STATUS.GAME_ACTION_DO_BET,i.currentGame=o.currentGameInfo;var r={type:t,money:e,numbers:n};i.gameData=r,this.sendData(JSON.stringify(i))},n.prototype.betSuccess=function(e){t.createFlashNotify("Bet thành công."),window.location.href=window.location.href},n.prototype.processMessageData=function(t){var e;switch(t.action){case LOTTO_STATUS.GAME_ACTION_GET_CURRENT_GAME_INFO:var n=t.data;o.currentGameInfo.current_game_idx=null!==(e=n.current_game_idx)&&void 0!==e?e:"",this.onInitGameCallback&&this.onInitGameCallback(n);break;case LOTTO_STATUS.GAME_ACTION_DO_BET:this.betSuccess(t.data);case LOTTO_STATUS.GAME_ACTION_RETRIEVE_RESULT:}},n}(f),d=function(){function t(){}return t.get=function(t,e){return void 0===e&&(e={}),new Promise((function(n,o){XHR.send({url:t,method:"GET",data:e}).then((function(t){200==t.code&&t.html?n(t):o(t)}))}))},t}();const y=function(){function n(t,e,n){this.formbet=t,this.gameChoose=e,this.gameSelect=n}return n.prototype.init=function(){this.initEvents(),this.showQuestion()},n.prototype.initEvents=function(){this.initEventCategoryChange(),this.initEventTypeChange()},n.prototype.initEventCategoryChange=function(){var n=this,o=e.all(".item_type_game input");if(o.forEach((function(o){o.addEventListener("change",(function(o){return i=this,r=void 0,s=function(){var o,i,r,a,s;return function(t,e){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,o=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){a.label=r[1];break}if(6===r[0]&&a.label<i[1]){a.label=i[1],i=r;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(r);break}i[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}}(this,(function(c){switch(c.label){case 0:return o=this,i=this.parentElement,r=o?o.value:0,t.showLoading(),[4,n.getGameContent(r)];case 1:return a=c.sent(),t.hideLoading(),(s=e._(i.getAttribute("data-target"))).parentElement.querySelectorAll(":scope > .panel").forEach((function(t,e){t.innerHTML=""})),s.innerHTML=a.html,n.updateAfterGetGameContent(),[2]}}))},new((a=void 0)||(a=Promise))((function(t,e){function n(t){try{c(s.next(t))}catch(t){e(t)}}function o(t){try{c(s.throw(t))}catch(t){e(t)}}function c(e){var i;e.done?t(e.value):(i=e.value,i instanceof a?i:new a((function(t){t(i)}))).then(n,o)}c((s=s.apply(i,r||[])).next())}));var i,r,a,s}),!1)})),o.length>0){var i=o[0],r=new Event("change");i.dispatchEvent(r)}},n.prototype.updateAfterGetGameContent=function(){this.formbet.updateBoxTitle(),this.formbet.changeHtmlPreview()},n.prototype.initEventTypeChange=function(){var t=this;e.on("change",".type_js.nav-item input[name=type]",(function(e){t.clearChoosenItem(),t.formbet.updateBoxTitle()}))},n.prototype.clearChoosenItem=function(){this.gameChoose.removeChoosen(),this.gameSelect.removeChoosen()},n.prototype.getGameContent=function(t){return d.get("get-game-lotto-content",{typeGame:t})},n.prototype.showQuestion=function(){e.on("click","span.question",(function(t){var e=t.target.nextElementSibling;e&&(e.classList.contains("active")?e.classList.remove("active"):e.classList.add("active"))}))},n}();new(function(){function t(t){void 0===t&&(t=".nav-item"),this.selector=t,this.initEvents()}return t.prototype.initEvents=function(){var t=this;e.on("click",this.selector,(function(n){var o=n.target,i=o.dataset.target,r=e._(i);r&&(r.parentElement.querySelectorAll(":scope > .panel").forEach((function(t,e){t.style.display="none",t.dataset.state="hide"})),r.style.display="block",r.dataset.state="show",o.parentElement.querySelectorAll(":scope > "+t.selector).forEach((function(t,e){t.dataset.state="false"})),o.dataset.state="true")}))},t}());var g=new v(new n("ws://localhost:8888/")),_=new p(g);g.onOpenSocketCallback=function(){},g.onInitGameCallback=function(t){_.initInfo(t)},g.init();var b=new r(g);new y(b,new u(b),new h(b)).init()})();